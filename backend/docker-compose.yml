# docker-compose.yml

version: "3.8" # 파일 버전 (그대로 두시면 됩니다)

services:
  # 'db'는 이 서비스의 별명입니다. 원하면 'postgres' 등으로 바꿔도 됩니다.
  db:
    # 1. 사용할 PostgreSQL 이미지 (버전 16을 사용, alpine은 용량이 작은 버전)
    image: postgres:16-alpine

    # 2. (자동화 핵심) 컨테이너 환경 변수 설정
    # 이 이미지(postgres)는 이 변수들을 보고 자동으로 DB와 사용자를 생성합니다.
    environment:
      POSTGRES_USER: myuser # 원하는 사용자 이름
      POSTGRES_PASSWORD: mypassword # 원하는 비밀번호
      POSTGRES_DB: mydatabase # 자동으로 생성할 데이터베이스 이름

    # 3. 포트 연결 ( "내PC포트:컨테이너포트" )
    # 내 PC(localhost)의 5432 포트로 오는 요청을
    # 컨테이너의 5432 포트로 연결합니다.
    ports:
      - "5432:5432"

    # 4. (데이터 영구 저장) 볼륨 설정
    # 이 부분이 없으면 컨테이너를 껐다 켤 때마다 데이터가 전부 사라집니다!
    # 'postgres_data'라는 이름의 볼륨을 컨테이너의 데이터 경로에 연결합니다.
    volumes:
      - postgres_data:/var/lib/postgresql/data

# 4-1. 위에서 사용한 'postgres_data' 볼륨을 공식적으로 정의합니다.
volumes:
  postgres_data:
