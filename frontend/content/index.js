(function(){const MSG={PROCESS_PAGE_TEXT:"PROCESS_PAGE_TEXT",FILTER_TEXTS:"FILTER_TEXTS",ENABLE_FILTERING:"ENABLE_FILTERING",DISABLE_FILTERING:"DISABLE_FILTERING"};const{collectTexts,debounce}=window.WPScanner;const{applyBlurByIds}=window.WPApply;function send(){const p=collectTexts();if(p.length)chrome.runtime.sendMessage({type:MSG.PROCESS_PAGE_TEXT,payload:p})}chrome.storage.local.get("settings",d=>{if(d?.settings?.isEnabled){document.body.classList.add("webpurifier-active");send()}});chrome.runtime.onMessage.addListener(m=>{if(!m||!m.type)return;if(m.type===MSG.FILTER_TEXTS)applyBlurByIds(m.payload||[]);else if(m.type===MSG.ENABLE_FILTERING){document.body.classList.add("webpurifier-active");send()}else if(m.type===MSG.DISABLE_FILTERING){document.body.classList.remove("webpurifier-active")}});const obs=new MutationObserver(debounce(send,600));obs.observe(document.documentElement,{subtree:true,childList:true,characterData:true})})();
